// 
// Decompiled by Procyon v0.6.0
// 

package com.mentalfrostbyte.jello.mods.impl.exploit;

import com.mentalfrostbyte.Client;
import com.mentalfrostbyte.jello.mods.Category;
import com.mentalfrostbyte.jello.mods.Module;
import com.mojang.brigadier.suggestion.Suggestion;
import mapped.*;

import java.util.Iterator;
import java.io.IOException;
import java.io.FileWriter;
import java.io.File;
import java.util.ArrayList;
import java.util.List;

public class Dumper extends Module
{
    public String field15864;
    public List<String> field15865;
    public List<String> field15866;
    
    public Dumper() {
        super(Category.EXPLOIT, "Dumper", "Dumps the plugins/commands from the server");
        this.field15864 = null;
        this.field15865 = new ArrayList<String>();
        this.field15866 = new ArrayList<String>();
    }
    
    @Override
    public void onEnable() {
        this.field15864 = null;
        this.field15865.clear();
        this.field15866.clear();
        AllUtils.method19106("Dumping...");
        this.method10453("");
    }
    
    @Override
    public void onDisable() {
        AllUtils.method19106("Done.");
        AllUtils.method19106("§aPlugins:");
        final StringBuilder sb = new StringBuilder();
        final Iterator<String> iterator = this.field15866.iterator();
        while (iterator.hasNext()) {
            sb.append(iterator.next()).append(", ");
        }
        final String substring = sb.substring();
        AllUtils.method19106(substring);
        AllUtils.method19106("§aCommands:");
        final StringBuilder sb2 = new StringBuilder();
        final Iterator<String> iterator2 = this.field15865.iterator();
        while (iterator2.hasNext()) {
            sb2.append(iterator2.next()).append(", ");
        }
        final String substring2 = sb2.substring();
        AllUtils.method19106(substring2);
        try {
            final File file = new File(Client.getInstance().getFile() + "/plugin_and_command_dump.txt");
            if (!file.exists()) {
                file.createNewFile();
            }
            final FileWriter fileWriter = new FileWriter(file);
            fileWriter.write("Plugins: " + substring + "\n\n");
            fileWriter.write("Commands: " + substring2 + "\n");
            fileWriter.close();
            AllUtils.method19106("§bDumped to: " + file.getAbsolutePath());
        }
        catch (final IOException ex) {
            ex.printStackTrace();
            AllUtils.method19106("§cCould not save dump file.");
        }
    }
    
    private String method10451() {
        return this.field15864.equals("") ? "a" : (this.field15864.equals("z") ? null : Character.toString((char)(this.field15864.charAt(0) + '\u0001')));
    }
    
    @EventListener
    private void method10452(final EventReceivePacket eventReceivePacket) {
        if (this.isEnabled()) {
            if (eventReceivePacket.getPacket() instanceof Class4337) {
                for (final Suggestion suggestion : ((Class4337) eventReceivePacket.getPacket()).method13021().getList()) {
                    final String[] split = suggestion.getText().split(":");
                    if (split.length > 1) {
                        final String substring = split[0].substring(1);
                        if (!substring.equals("minecraft")) {
                            if (!substring.equals("bukkit")) {
                                if (!this.field15866.contains(substring)) {
                                    this.field15866.add(substring);
                                }
                            }
                        }
                    }
                    if (this.field15865.contains(suggestion.getText())) {
                        continue;
                    }
                    this.field15865.add(suggestion.getText());
                }
                final String method10451 = this.method10451();
                if (method10451 == null) {
                    this.toggle();
                }
                else {
                    this.method10453(method10451);
                }
            }
        }
    }
    
    private void method10453(final String s) {
        this.field15864 = s;
        Dumper.mc.method5269().method17292(new Class4265(0, "/" + s));
    }
}
